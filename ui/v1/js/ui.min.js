/*
*
*  florin JS engine
*  Version: 1.0.0
*  Updated: 20171123
*  URI: https://payapi.io
*  Author: florin
*. Author URI: https://www.josebamirena.com/
*  Copyright: PayApi.io
*  License: GPL2
*
*/
var payapi_js={api:"input.payapi.io",signed:!1,settings:{debug:!0},ed:null,button:null,label:{modal:"payapi_modal",notice:"form_top_notice",formPayment:"payapi_payment",formSignin:"payapi_signin",advanced:"advanced_settings",advancedFocus:"product_taxes",productFocus:"product_name",signingFocus:"payapi_public_id"},schema:{product:{name:{mandatory:!0,select:!1},price:{mandatory:!0,select:!1},quantity:{mandatory:!0,select:!0},currency:{mandatory:!0,select:!0},taxes:{mandatory:!1,select:!1},shipping:{mandatory:!1,select:!1},image:{mandatory:!1,select:!1}},signin:{public_id:{mandatory:!0,select:!1},api_key:{mandatory:!0,select:!1},mode:{mandatory:!0,select:!0},token:{mandatory:!0,select:!1}}},getId:function(e){return document.getElementById(e)},display:function(e){jQuery(this.getId(e)).fadeIn("slow").css("display","block")},hide:function(e){jQuery(this.getId(e)).fadeOut("slow",function(){jQuery(payapi_js.getId(e)).css("display","none")})},close:function(){this.hide(this.label.modal)},visible:function(e,i){!0===i?jQuery(this.getId(e)).fadeIn("slow").css("visibility","visible"):jQuery(this.getId(e)).fadeOut().css("visibility","hidden")},login:function(){this.reset(),this.visible(this.label.formSignin),this.sleep(1e3).then(function(){payapi_js.validateSignin(),payapi_js.visible(payapi_js.label.formSignin,!0)})},curl:function(e,i){jQuery.post(e,i,function(e,i,t){return payapi_js.response(e,i,t)})},response:function(e,i,t){return payapi_js.debug("response ["+i+"] "+JSON.stringify(e)),"success"===i&&200===e.code?(this.signed=e.code,this.success("login success"),payapi_js.debug("response ["+e.code+"] "+this.signed),setTimeout(location.reload.bind(location),1e3)):this.error("no valid signin data"),i},code:function(){this.hide(this.label.advanced),this.display(this.label.modal),this.getId(this.label.productFocus).focus()},validateProduct:function(){var e=this.elements(this.label.formPayment);this.debug("payment form: "+JSON.stringify(e));var i=!1,t=null;for(var n in this.schema.product)t="product_"+n,0==i&&(!1===this.schema.product[n].mandatory||e.hasOwnProperty(t)&&void 0!=e[t]&&""!=e[t]?this.debug(t+":"+e[t]):(this.debug("validation error: "+n),i=!0));return!1===i&&e},validateSignin:function(){var e=jQuery("#payapi_public_id").val(),i=jQuery("#payapi_api_key").val(),t=jQuery("#payapi_mode").val(),n=jQuery("#payapi_token").val();if(void 0!=e&&""!=e&&void 0!=i&&""!=i){var s={public_id:e,api_key:i,mode:t,token:n};return this.curl(this.getId(this.label.formSignin).action,s),!0}var a="no valid signin data";return this.debug("error: "+a),this.error(a),!1},elements:function(e){for(var i=document.getElementById(e).elements,t={},n=0;n<i.length;n++){var s=i.item(n);t[s.name]=s.value}return t},handler:function(e){this.ed=e,this.code()},button:function(){var e=this.validateProduct();if(0!=e){this.debug("payment form: "+JSON.stringify(e));var i="[(payapi-button)(name="+e.product_name+",price="+e.product_price+",quantity="+e.product_quantity+",currency="+e.product_currency+",taxes="+e.product_taxes+",shipping="+e.product_shipping+",image="+e.product_image+")]";this.ed.execCommand("mceInsertContent",0,i),this.close()}else this.error("no valid product data")},error:function(e){this.debug("error: "+e),this.getId(this.label.notice).className="form_top_notice fail",this.getId(this.label.notice+"_text").innerHTML=e,this.display(this.label.notice)},success:function(e){this.reset(),this.getId(this.label.notice).className="form_top_notice success",this.getId(this.label.notice+"_text").innerHTML=e,this.display(this.label.notice),this.debug("login success")},reset:function(){this.hide(this.label.notice),this.getId(this.label.notice+"_text").innerHTML=""},sleep:function(e){return new Promise(resolve => setTimeout(resolve,e))},advanced:function(){"block"!==this.getId(this.label.advanced).style.display?(this.display(this.label.advanced),this.getId(this.label.advancedFocus).focus()):(this.hide(this.label.advanced),this.getId(this.label.productFocus).focus())},signup:function(){var e=this.api,i=jQuery("#payapi_mode option:selected").val();return console.log("signin into "+jQuery("#payapi_mode option:selected").text()),1!=i&&(e="staging-"+this.api),this.getId(this.label.signingFocus).focus(),window.open("https://"+e+"/#!/signup"),!1},signin:function(){var e=this.api,i=jQuery("#payapi_mode option:selected").val();return console.log("signin into "+jQuery("#payapi_mode option:selected").text()),1!=i&&(e="staging-"+this.api),this.getId(this.label.signingFocus).focus(),window.open("https://"+e+"/#!/signin"),!1},setup:function(){this.display(this.label.modal),this.getId(this.label.signingFocus).focus()},filterPrice:function(e){var i=e.which?e.which:e.keyCode,t=this.getId(e.target.id).value,n=!1;if(this.debug(i+":"+e.target.id+":"+t),null!=t.match(/\./i)){t.match(/\./i);t.split(".")[1].length>=2&&(n=!0)}if(!1===n&&(45===i||46===i||i>=48&&i<=57)){if(i>=49&&i<=57)return!0;if(48==i)return!0;if(45===i&&""==t)return!0;if(46===i&&""!=t&&null==t.match(/\./i))return!0}return!1},isImage:function(e){this.isImageCallback(e,function(e){return e})},isImageCallback:function(e,i){var t=new Image;t.onload=function(){i(!0)},t.onerror=function(){i(!1)},t.src=e},debug:function(e){return!0!==this.settings.debug||console.log(e)}};document.addEventListener("DOMContentLoaded",function(e){(new WOW).init(),console.log("WOW v1.1.3"),console.log("PayApi JS")});